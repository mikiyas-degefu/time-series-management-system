{% load static %}
{% load custom_tags %}
<!DOCTYPE html>
<html lang="en">

  <!-- [Head] start -->

  <head>
    <title>Home | MoPD Dashboard </title>
    <meta charset="utf-8" />
    <meta name="viewport"
      content="width=device-width,initial-scale=1,user-scalable=0,minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description"
      content="MoPD Dashboard" />
    <meta name="keywords"
      content="MoPD Dashboard" />
    <meta name="author" content="Phoenixcoded" />
    <link rel="stylesheet"
      href="https://code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
    <script
      src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/js/multi-select-tag.js"></script>
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/css/multi-select-tag.css" />
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/jquery-toast-plugin@1.3.2/dist/jquery.toast.min.css">

    {% include 'dashboard/common/head.html' %}

    <script src="https://cdn.jsdelivr.net/npm/choices.js@11.0.2/public/assets/scripts/choices.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/choices.js@11.0.2/public/assets/styles/choices.min.css" rel="stylesheet">



  </head>
  <!-- [Head] end -->
  <style>
    .pc-content {
        min-height: 100vh;
    }

    .pc-content img {
        width: 500px;
    }
</style>

  <body data-pc-preset="preset-1" data-pc-sidebar-caption="true"
    data-pc-layout="vertical" data-pc-direction="ltr"
    data-pc-theme_contrast data-pc-theme="light">

    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
      <div class="loader-track">
        <div class="loader-fill"></div>
      </div>
    </div>
    <!-- [ Pre-loader ] End -->

    <!-- [ Sidebar Menu ] start -->
    <nav class="pc-sidebar">
      <div class="navbar-wrapper">
        <div class="text-center">
          <a href="{% url "dashboard_detail" dashboard.id %}"> 
          <h3 class="bg-primary text-light p-3">{{dashboard.title | capfirst}}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM8 12.5c-3.314 0-6-3.582-6-4.5s2.686-4.5 6-4.5 6 3.582 6 4.5-2.686 4.5-6 4.5z"/>
                  <path d="M8 5a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>
              </svg> 
          </h3>
        </a>
        </div>
        <div class="navbar-content">

          <ul class="pc-navbar">

            <li class="pc-item  pc-caption">
              <label>Dashboards</label>
              <svg class="pc-icon">
                <use xlink:href="#custom-presentation-chart"></use>
              </svg>
            </li>


           


            <li class="pc-item pc-hasmenu active pc-trigger">

              <a href="#" class="pc-link">
                <span class="pc-micon">
                  <svg class="pc-icon"><use
                      xlink:href="#custom-status-up"></use></svg>
                </span>
                <span class="pc-mtext">Row</span>

                <span class="pc-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-chevron-right">
                    <polyline points="9 18 15 12 9 6"></polyline>
                  </svg>
                </span>
              </a>

              <ul class="pc-submenu"
                style="display: block; box-sizing: border-box;">

                <li class="pc-item active">
                  <a name="row" class="pc-link border" href="#">Full Width</a>
                </li>

              </ul>

            </li>

            <li class="pc-item pc-hasmenu close pc-trigger">

              <a href="#" class="pc-link">
                <span class="pc-micon">
                  <svg class="pc-icon">
                    <use xlink:href="#custom-status-up"></use>
                  </svg>
                </span>
                <span class="pc-mtext">Charts</span>

                <span class="pc-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="feather feather-chevron-right">
                    <polyline points="9 18 15 12 9 6"></polyline>
                  </svg>
                </span>
              </a>

              <ul class="pc-submenu"
                style="display: block; box-sizing: border-box;">

                {% for component in components%}
                <li class="pc-item active">
                  <a class="pc-link" href="#">{{component.name}}</a>
                  <div
                    name="component"
                    data-id="{{component.id}}"
                    data-is-multiple="{{component.is_multiple}}"
                    data-is-range="{{component.is_range}}"
                    data-is-single-year="{{component.is_single_year}}"
                    data-has-title="{{component.has_title}}"
                    data-has-description="{{component.has_description}}"
                    data-has-indicator="{{component.has_indicator}}"
                    data-is-country="{{component.is_country}}"
                    data-has-icon="{{component.has_icon}}"
                    data-is-image-component="{{component.is_image_component}}"
                    data-is-custom="{{component.is_custom}}"
                    class="text-center">
                    <img src="/media/{{component.image}}" style="width: 150px;"
                      class="img-fluid" alt>
                  </div>
                </li>
                {% endfor %}

              </ul>

            </li>

          </ul>

        </div>

      </div>
    </nav>
    <!-- [ Sidebar Menu ] end -->

    {% include 'dashboard/common/header.html' %}

    <div class="pc-container">

      <!-- [ Main Content ] start -->
      <div class="pc-content">

        <div id="droppable2" name="drop-element" style="padding-bottom: 140px;"  class="ui-droppable ">

          <!-- Start Editable components-->
          {% for row in rows%}
          <div name="row" id="{{row.id}}" data-rank="{{row.rank}}" class="bg-gray-300 row {{row.style}} p-5 border mt-1 rounded-3">

            <div class="d-flex align-items-center justify-content-between mb-3">
              <small id="rank-text-{{row.id}}" class="mb-0">rank - {{row.rank}}</small>
              <div class="dropdown">
                  <a class="avtar avtar-s btn-link-secondary dropdown-toggle arrow-none" href="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="ti ti-dots-vertical f-18"></i>
                  </a>
                  <div class="dropdown-menu dropdown-menu-end">
                    <button 
                      class="dropdown-item" 
                      name="btn-style-row" 
                      data-bs-toggle="modal" 
                      data-bs-target="#modalRowStyle"
                      data-row-id="{{row.id}}"
                      data-row-style="{{row.style}}"
                      >Style
                    </button>
                    <button 
                      class="dropdown-item" 
                      name="btn-rank-row" 
                      data-bs-toggle="modal" 
                      data-bs-target="#modalRowRank"
                      data-row-id="{{row.id}}"
                      data-row-rank="{{row.rank}}"
                      >Edit row
                    </button>
                    <button 
                      class="dropdown-item text-danger" 
                      name="btn-delete-row" 
                      data-bs-toggle="modal" 
                      data-bs-target="#removeRow"
                      data-row-id="{{row.id}}"
                      >Delete
                    </button>
                  </div>
              </div>
            </div>
            
            {% for col in row.cols.all%}
            <div name="col_component" data-rank="{{col.rank}}" id="dragged_col_{{col.id}}" class="col-md-{% if col.width == '100%' %}12{% elif col.width == '50%' %}6{% elif col.width == '33%' %}4{% elif col.width == '25%' %}3{% else %}12{% endif %} row-col ui-sortable-handle">
            
              <div class="card">
                <div class="card-body">
                  <!--card header-->
                  <div class="d-flex align-items-center">

                    <!--Indicator Title-->
                    <div id="col-rank-info-col_{{col.id}}" class="flex-grow-1 ms-3">
                      <i class="fas fa-check-circle text-success" data-bs-toggle="tooltip" data-bs-placement="top" title="component created!"></i>
                      <small class="mb-0">col rank - {{col.rank}}</small>
                    </div>

                    <!--Detail Button-->
                    <div class="flex-shrink-0 ms-3">
                      <div class="dropdown">
                        <a class="avtar avtar-s btn-link-primary dropdown-toggle arrow-none"
                          href="#" data-bs-toggle="dropdown"
                          aria-haspopup="true" aria-expanded="false">
                          <i class="ti ti-dots-vertical f-18"></i>
                        </a>
                      
                        <div class="dropdown-menu dropdown-menu-end">
                          <!--Col edit button-->
                          <button 
                            type="button" 
                            name="btn-edit" 
                            id="col_{{col.id}}"
                            data-id="{{col.component.id}}"
                            data-is-multiple="{{col.component.is_multiple}}" 
                            data-is-single-year="{{col.component.is_single_year}}"
                            data-is-range="{{col.component.is_range}}" 
                            data-is-custom="{{col.component.is_custom}}"
                            data-row-id="{{row.id}}"
                            data-has-title="{{col.component.has_title}}" 
                            data-has-indicator="{{col.component.has_indicator}}"
                            data-has-description="{{col.component.has_description}}" 
                            data-col-rank="{{col.rank}}"
                            data-col-id="{{col.id}}"
                            data-col-indicator-id="{{ col.indicator.all|get_ids }}"
                            data-col-width="{{col.width}}"
                            data-col-title="{{col.title}}"
                            data-col-description="{{col.description}}"
                            data-col-data-range-start="{{col.data_range_start.id}}"
                            data-col-data-range-end="{{col.data_range_end.id}}"
                            data-is-country="{{col.component.is_country}}"
                            data-is-image-component="{{col.component.is_image_component}}"
                            data-has-icon="{{col.component.has_icon}}"
                            data-col-addis-ababa = "{{col.addis_ababa}}"
                            data-col-tigray = "{{col.tigray}}"
                            data-col-amhara = "{{col.amhara}}"
                            data-col-oromia = "{{col.oromia}}"
                            data-col-somali = "{{col.somali}}"
                            data-col-afar = "{{col.afar}}"
                            data-col-benshangul-gumuz = "{{col.benshangul_gumuz}}"
                            data-col-dire-dawa = "{{col.dire_dawa}}"
                            data-col-gambella = "{{col.gambella}}"
                            data-col-snnp = "{{col.snnp}}"
                            data-col-harari = "{{col.harari}}"
                            data-col-custom-value = "{{col.custom_value}}"
                            data-bs-toggle="modal"
                            data-bs-target="#modalAddDashboardRow"
                            class="dropdown-item">
                            <svg class="pc-icon"> <use
                                xlink:href="#custom-flash"></use></svg>
                            Edit
                          </button>

                            <!--Col Delete  Button-->
                          <button 
                            type="button" 
                            name="btn-delete"
                            data-col-id="{{col.id}}" 
                            data-is-created="True"
                            data-bs-toggle="modal" 
                            data-bs-target="#removeComponent"
                            class="dropdown-item">
                            <i class="text-danger ti ti-x f-20 "></i>
                            <span class="text-danger">Delete</span>
                          </button>
                        </div>

                        
                      </div>
                    </div>

                  </div>

                  <div 
                    name="component" 
                    data-id="{{col.component.id}}" 
                    data-is-multiple="{{col.component.is_multiple}}"
                    data-is-range="{{col.component.is_range}}" 
                    data-is-single-year="{{col.component.is_single_year}}"
                    data-has-title="{{col.component.has_title}}" 
                    data-has-description="{{col.component.has_description}}"
                    data-has-indicator="{{col.component.has_indicator}}"
                    class="text-center ui-draggable ui-draggable-handle">
                    <img
                      src="/media/{{col.component.image}}"
                      style="width: 100%;" class="img-fluid" alt>
                  </div>

                </div>
              </div>
              
            </div>
            {% endfor %}

          </div>
          {% endfor %} 
          <!--end Editable components-->

          
        </div>
      </div>
        <!--Modal Add Dashboard Row-->
        <div class="modal fade" id="modalAddDashboardRow" tabindex="-1"
          aria-labelledby="modalAddDashboardRowLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalAddDashboardRowLabel">Add
                  Dashboard</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <form id="form-configuration" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                  <input id="form_col_id" type="hidden" value name="col-id">
                  {{form.as_p}}
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button  name="btn-loading" class="btn btn-primary lh-1" style="display: none;" type="button" disabled="disabled"><span class="spinner-border spinner-border-sm" role="status"></span> Loading...</button>
                  <button name="btn-submit" type="submit" class="btn btn-primary">Save changes</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Modal Delete Col -->
        <div class="modal fade" id="removeComponent" tabindex="-1" aria-labelledby="removeComponentLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="removeComponentLabel">Delete Row</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <form id="delete_modal" method="post">
                <div class="modal-body">
                  <input id="delete_input_col_id" type="hidden">
                  <input id="delete_input_id_created" type="hidden">
                 Are you sure you want to remove this component?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button  name="btn-loading" class="btn btn-primary lh-1" style="display: none;" type="button" disabled="disabled"><span class="spinner-border spinner-border-sm" role="status"></span> Loading...</button>
                  <button name="btn-submit" type="submit" class="btn btn-primary">Save changes</button>
                </div>
              </form>
            </div>
          </div>
        </div>

         <!-- Modal Delete row -->
         <div class="modal fade" id="removeRow" tabindex="-1" aria-labelledby="removeRowLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="removeRowLabel">Delete Row</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <form id="delete-row-modal" method="post">
                <div class="modal-body">
                  <input id="delete_row_id" type="hidden">
                  Are you sure you want to remove this row? Deleting it may impact any columns contained within.
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button  name="btn-loading" class="btn btn-primary lh-1" style="display: none;" type="button" disabled="disabled"><span class="spinner-border spinner-border-sm" role="status"></span> Loading...</button>
                  <button name="btn-submit" type="submit" class="btn btn-primary">Save changes</button>
                </div>
              </form>
            </div>
          </div>
        </div>

         <!-- Modal row rank -->
         <div class="modal fade" id="modalRowRank" tabindex="-1" aria-labelledby="modalRowRankLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalRowRankLabel">Rank Row</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <form id="rank-row-modal" method="post">
                <div class="modal-body">
                  <p>Are you sure you want to modify the ranking of this row? This may impact the current order.</p>
                  <label class="form-label" for="row_rank_input">Input rank:</label>
                  <input type="number" class="form-control" id="row_rank_input">
                  <input type="hidden" class="form-control" id="row_rank_input_row_id">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button  name="btn-loading" class="btn btn-primary lh-1" style="display: none;" type="button" disabled="disabled"><span class="spinner-border spinner-border-sm" role="status"></span> Loading...</button>
                  <button name="btn-submit" type="submit" class="btn btn-primary">Save changes</button>
                </div>
              </form>
            </div>
          </div>
        </div>

          <!-- Modal row style -->
          <div class="modal fade" id="modalRowStyle" tabindex="-1" aria-labelledby="modalRowStyleLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalRowStyleLabel">Row Style</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="style-row-modal" method="post">
                  <div class="modal-body">
                    <p>Are you sure you want to update the style of this row? Please note that this alteration could impact the arrangement of the existing components.</p>
                    {{form_row_style.as_p}}
                    <input type="hidden" class="form-control" id="row_row_input_row_id">
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>



        {% include 'dashboard/common/js.html'%}

        <script
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
          integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.0/jquery-ui.min.js"
          integrity="sha512-MlEyuwT6VkRXExjj8CdBKNgd+e2H+aYZOCUaCrt9KRk6MlZDOs91V1yK22rwm8aCIsb5Ec1euL8f0g58RKT/Pg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script
          src="https://cdn.jsdelivr.net/npm/jquery-toast-plugin@1.3.2/dist/jquery.toast.min.js"></script>

        <script type="text/javascript">


         const showToast = (title, body, cssClass) => {
               $.toast({
                heading: title,
                text: body,
                showHideTransition: 'slide',
                icon: cssClass,
                position: 'top-right',
              })
            }
         
        //handle backend row created
        const handleRowCreated = async () => {
        try {
          let id = await new Promise((resolve, reject) => {
            $.ajax({
              type: 'POST',
              url: `{% url "custom-dashboard-topic" dashboard.id %}`,
              data: {
                'rank': 1,
                csrfmiddlewaretoken: '{{csrf_token}}'
              },
              success: function (response) {
                if (response.success) {
                  resolve([response.row, response.rank]);  // Resolve with the row ID
                } else {
                  reject("Error: Failed to get ID");
                }
              },
              error: function () {
                reject("Error: AJAX request failed");
              }
            });
          });
      
          return id;  // Return the ID after successful AJAX call
      
        } catch (error) {
          console.error(error);  // Log the error if something goes wrong
          return null;  // Return null in case of an error
        }
    };


         //handle on modal col created
         $("#form-configuration").on('submit', (e)=>{
            e.preventDefault();   

            let colId = $("#form_col_id").val();  // Get the column ID

            let isMultiple = $(`#${colId}`).data('isMultiple')
            let isRange =$(`#${colId}`).data('isRange');
            let componentId = $(`#${colId}`).data('id');
            
            let rowId = $(`#${colId}`).data('rowId') || null;

            let indicator = $("#id_indicator").val();
            indicator = isMultiple ? indicator : [indicator]

            let title = $("#id_title").val()
            let description = $("#id_description").val()
            let year = $("#id_year").val();
            let data_range_start = $("#id_data_range_start").val();
            let data_range_end = $("#id_data_range_end").val();
            let rank = $('#id_rank').val()
            let width = $("#id_width").val();  
            
            let addisAbaba = $("#id_addis_ababa").val()
            let tigray = $("#id_tigray").val()
            let amhara = $("#id_amhara").val()
            let oromia = $("#id_oromia").val()
            let somali = $("#id_somali").val()
            let afar = $("#id_afar").val()
            let benshangulGumuz = $("#id_benshangul_gumuz").val()
            let direDawa = $("#id_dire_dawa").val()
            let gambella = $("#id_gambella").val()
            let snnp = $("#id_snnp").val()
            let harari = $("#id_harari").val()

            let customValue =  $("#id_custom_value").val() || null

           
            function readFileAsArrayBuffer(file) {
              return new Promise((resolve, reject) => {
                let reader = new FileReader();
                reader.onload = function(event) {
                  resolve(event.target.result); // Resolve with the ArrayBuffer
                };
                reader.onerror = function(error) {
                  reject(error); // Reject on error
                };
                reader.readAsArrayBuffer(file);
              })
            }


            let colSize = width == '25%' ? 'col-md-3' : (width == '33%' ? 'col-md-4' : (width == '50%' ? 'col-md-6' : (width == '100%' ? 'col-md-12' : '')));

            try{
              document.getElementById(`dragged_${colId}`).className = colSize;
            }catch{
              document.getElementById(`dragged_${colId}`).className = colSize;
            }
            
            const handlePOSTRequest = async () => {

              let formData = new FormData();
              formData.append('dashboardId',  $(`#${colId}`).data('col-id') ? $(`#${colId}`).data('col-id') : null)
              formData.append('isMultiple', isMultiple);
              formData.append('isRange',  isRange);
              formData.append('title',  title || null);
              formData.append('description',  description || null);
              formData.append('componentId',  componentId);
              formData.append('indicator',  indicator);
              formData.append('year',  year);
              formData.append('data_range_start',  data_range_start || null);
              formData.append('data_range_end',  data_range_end || null);
              formData.append('rowId',  rowId);
              formData.append('isMultiple', isMultiple);
              formData.append('width',  width);
              formData.append('colRank',  rank);
              formData.append('addisAbaba',  addisAbaba || null);
              formData.append('tigray',  tigray || null);
              formData.append('amhara',  amhara || null);
              formData.append('oromia',  oromia || null);
              formData.append('somali',  somali || null);
              formData.append('afar',  afar || null);
              formData.append('benshangulGumuz',  benshangulGumuz || null,);
              formData.append('direDawa',  direDawa || null);
              formData.append('gambella',  gambella || null,);
              formData.append('snnp',  snnp || null);
              formData.append('harari',  harari || null);
              formData.append('customValue',  customValue || null);
              formData.append('icon', $('#id_icon')[0].files[0] || null);
              formData.append('image', $('#id_image')[0].files[0] || null);
              formData.append('csrfmiddlewaretoken', "{{ csrf_token }}");

              $.ajax({
              type: 'POST',
              url: `{% url "custom-dashboard-topic" dashboard.id %}`,              
              data: formData,
            
              beforeSend: function() {
               $("[name='btn-submit']").hide()
                $("[name='btn-loading']").show();
              },
              // hides the loader after completion of request, whether successfull or failor.             
              complete: function() {
               //Show save button finished 
               $("[name='btn-submit']").show()
                $("[name='btn-loading']").hide();
              },

              success: function (response) {
                if (response.success) {

                  //assign real data to col
                  $(`#${colId}`).data('col-id', response.id) 
                  $(`#${colId}`).data('col-indicator-id', indicator) 
                  $(`#${colId}`).data('col-year-id', year) 
                  $(`#${colId}`).data('col-width', width)
                  $(`#${colId}`).data('col-title', title)
                  $(`#${colId}`).data('col-description', description)
                  $(`#${colId}`).data('col-data-range-start', data_range_start) 
                  $(`#${colId}`).data('col-data-range-end', data_range_end)
                  $(`#${colId}`).data('col-rank', response.rank);
                  //country data
                  $(`#${colId}`).data('col-addis-ababa', addisAbaba);
                  $(`#${colId}`).data('col-tigray', tigray);
                  $(`#${colId}`).data('col-amhara', amhara);
                  $(`#${colId}`).data('col-oromia', oromia);
                  $(`#${colId}`).data('col-somali', somali);
                  $(`#${colId}`).data('col-afar', afar);
                  $(`#${colId}`).data('col-benshangul-gumuz', benshangulGumuz);
                  $(`#${colId}`).data('col-dire-dawa', direDawa);
                  $(`#${colId}`).data('col-gambella', gambella);
                  $(`#${colId}`).data('col-snnp', snnp);
                  $(`#${colId}`).data('col-harari', harari);
                  

                  //custom
                  $(`#${colId}`).data('col-custom-value', customValue);

                  $(`#dragged_${colId}`).attr('data-rank', response.rank) //update col rank 

                  sortCol(rowId) //sort col

                  //update col rank and update the html 
                  $(`#col-rank-info-${colId}`).html(`
                      <i class="fas fa-check-circle text-success" data-bs-toggle="tooltip" data-bs-placement="top" title="component created!"></i>
                      <small class="mb-0">col rank - ${response.rank}</small>
                  `)

                  try{    
                    //for update button
                    $(`#${colId}`).attr("id", `col_${response.id}`);
                    $(`#col-rank-info-${colId}`).attr("id", `col-rank-info-col_${response.id}`); //update rank html id

                    //for delete button
                    //update delete button data to component created true
                    $(`#delete_btn_${colId}`).attr("data-is-created", "True");

                    //update data of col-id
                    $(`#delete_btn_${colId}`).attr("data-col-id", response.id);
                    
                     //update id of col 
                     $(`#dragged_${colId}`).attr("id", `dragged_col_${response.id}`);

                  }catch{
                    console.log("ID Updated failed!")
                  }
                 
                   //show succuss message
                   showToast('&#128515 Hello, User', 'Successfully component created', 'success')
                   $('#modalAddDashboardRow').modal('hide'); //Hide Modal


                } else {
                  showToast('&#128577; Oops!', `Failed to updated ${response.message}`, 'error');
                }
              },
              cache: false,
              contentType: false,
              processData: false,
              error: function (err) {
                console.log(err)
              }
            });
            }

            handlePOSTRequest()

          


          })

        
        //handle on col-delete 
        $("#delete_modal").on('submit', async function(e){
        e.preventDefault()

        const colID = $("#delete_input_col_id").val()
        const isCreated = $(`#delete_input_id_created`).val() == 'True' ? true : false

        if(isCreated){
          $.ajax({
            type: 'DELETE',
            url: `{% url "custom-dashboard-topic" dashboard.id %}`,
            headers: {
              'X-CSRFToken': '{{ csrf_token }}'  // add CSRF token to headers
            },
            data: JSON.stringify({ 'id': colID, 'isCol' : true}),
            beforeSend: function() {
              $("[name='btn-submit']").hide()
               $("[name='btn-loading']").show();
             },
             // hides the loader after completion of request, whether successfull or failor.             
             complete: function() {
              //Show save button finished 
              $("[name='btn-submit']").show()
               $("[name='btn-loading']").hide();
             },
            success: function (response) {
                if (response.success) {
                     //show succuss message
                     showToast('&#128515 Hello, User', 'Successfully component removed', 'success')

                    $(`#dragged_col_${colID}`).remove() //remove from html
                    $('#removeComponent').modal('hide'); //Hide Modal

                } else {
                    // Show error message
                    showToast('&#128577; Oops!', `Failed to updated ${response.message}`, 'error');
                }
            },
            error: function () {
                // Show error message
                showToast('&#128577; Oops!', 'Failed to remove the component', 'error');
            }
          });
        }else{
            //show succuss message
            showToast('&#128515 Hello, User', 'Successfully component removed', 'success')
            
            $(`#dragged_col_${colID}`).remove() //remove from html
            $('#removeComponent').modal('hide'); //Hide Modal
        }
    })

        //handle on row-delete 
        $("#delete-row-modal").on('submit', async function(e){
            e.preventDefault()
    
            const rowID = $("#delete_row_id").val()
    
            $.ajax({
              type: 'DELETE',
              url: `{% url "custom-dashboard-topic" dashboard.id %}`,
              headers: {
                'X-CSRFToken': '{{ csrf_token }}'  // add CSRF token to headers
              },
              data: JSON.stringify({ 'id': rowID, 'isRow' : true }),
              beforeSend: function() {
                $("[name='btn-submit']").hide()
                 $("[name='btn-loading']").show();
               },
               // hides the loader after completion of request, whether successfull or failor.             
               complete: function() {
                //Show save button finished 
                $("[name='btn-submit']").show()
                 $("[name='btn-loading']").hide();
               },
              success: function (response) {
                  if (response.success) {
                       //show succuss message
                       showToast('&#128515 Hello, User', 'Successfully row removed', 'success')
                      $(`#${rowID}`).remove() //remove from html
                      $('#removeRow').modal('hide'); //Hide Modal
                  } else {
                      // Show error message
                      showToast('&#128577; Oops!', 'Failed to remove the row', 'error');
                  }
              },
              error: function () {
                  // Show error message
                  showToast('&#128577; Oops!', 'Failed to remove the row', 'error');
              }
            });
        })

        //handle on row-rank-updated 
        $("#rank-row-modal").on('submit', async function(e){
            e.preventDefault()
    
            const rank = $("#row_rank_input").val()
            const rowID = $("#row_rank_input_row_id").val()
    
            $.ajax({
              type: 'PATCH',
              url: `{% url "custom-dashboard-topic" dashboard.id %}`,
              headers: {
                'X-CSRFToken': '{{ csrf_token }}'  // add CSRF token to headers
              },
              data: JSON.stringify({ 'id': rowID, 'rank' : rank ,'isRow' : true }),
              beforeSend: function() {
                $("[name='btn-submit']").hide()
                 $("[name='btn-loading']").show();
               },
               // hides the loader after completion of request, whether successfull or failor.             
               complete: function() {
                //Show save button finished 
                $("[name='btn-submit']").show()
                 $("[name='btn-loading']").hide();
               },
              success: function (response) {
                  if (response.success) {
                       //show succuss message
                      showToast('&#128515 Hello, User', 'Successfully row rank updated!', 'success')
                      //find the element by its name and row id 
                      let element = $(`[name="btn-rank-row"][data-row-id="${rowID}"]`);
                      element.attr('data-row-rank', rank) //update data of button
                      $(`#${rowID}`).attr('data-rank', rank) //update row rank 
                      $(`#rank-text-${rowID}`).html(`rank - ${rank}`) //update rank small text 
                      sortRow()//sort row
                      $('#modalRowRank').modal('hide'); //Hide Modal
                     
                  } else {
                      // Show error message
                      showToast('&#128577; Oops!', `Failed to updated ${response.message}`, 'error');
                  }
              },
              error: function () {
                  // Show error message
                  showToast('&#128577; Oops!', 'Failed to update the row', 'error');
              }
            });
        })

         //handle on row-style-updated 
         $("#style-row-modal").on('submit', async function(e){
          e.preventDefault()
  
          const style = $("#id_style").val()
          const rowID = $("#row_row_input_row_id").val()
  
          $.ajax({
            type: 'PATCH',
            url: `{% url "custom-dashboard-topic" dashboard.id %}`,
            headers: {
              'X-CSRFToken': '{{ csrf_token }}'  // add CSRF token to headers
            },
            data: JSON.stringify({ 'id': rowID, 'style' : style ,'isRowStyle' : true }),
            beforeSend: function() {
              $("[name='btn-submit']").hide()
               $("[name='btn-loading']").show();
             },
             // hides the loader after completion of request, whether successfull or failor.             
             complete: function() {
              //Show save button finished 
              $("[name='btn-submit']").show()
               $("[name='btn-loading']").hide();
             },
            success: function (response) {
                if (response.success) {
                     //show succuss message
                    showToast('&#128515 Hello, User', 'Successfully row style updated!', 'success')
                   
                    let element = $(`[name="btn-style-row"][data-row-id="${rowID}"]`);
                    let oldStyle = element.attr('data-row-style')

                    $(`#${rowID}`).removeClass(oldStyle).addClass(style);
                    element.attr('data-row-style', style) //update data of button

                    $('#modalRowStyle').modal('hide'); //Hide Modal
                    
                } else {
                    // Show error message
                    showToast('&#128577; Oops!', `Failed to updated ${response.message}`, 'error');
                }
            },
            error: function () {
                // Show error message
                showToast('&#128577; Oops!', 'Failed to update the row', 'error');
            }
          });
      })


        /**
         * Sort row based on its rank
         */
        const sortRow =() =>{
          let items = $('#droppable2 [name="row"]');

          // Sort the items based on their data-rank attribute
          items.sort(function(a, b) {
              return $(a).data('rank') - $(b).data('rank'); // Ascending order
          });

          //updated the html 
          $('#droppable2').empty().append(items);

        }

        /**
         * Sort col based on its rank
         */
         const sortCol = (rowId) => {
          // Select items with name="col_component" within the specified row
          let items = $(`#${rowId} [name="col_component"]`);
      
          // Sort the items based on their data-rank attribute
          items.sort((a, b) => $(a).data('rank') - $(b).data('rank'));
      
          // Append each item to reorder them in the container
          items.each(function() {
              $(this).appendTo(`#${rowId}`);
          });
      };
      
    
    </script>

        <script
          src="{% static 'dashboard/assets/js/custom/dashboard-admin.js' %}"></script>

      </body>

    </html>